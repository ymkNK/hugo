{{/*{{ if and (gt .WordCount 400 ) (.Params.toc) }}*/}}
{{/*<section class="widget archives">*/}}
{{/*    <div class="widget-icon">*/}}
{{/*        {{ partial "helper/icon" "hash" }}*/}}
{{/*    </div>*/}}
{{/*    <h2 class="widget-title section-title">Table of contents</h2>*/}}
{{/*    <div class="widget-archive--toc">*/}}
{{/*        <aside>*/}}
{{/*            <header>*/}}
{{/*                <h2>{{.Title}}</h2>*/}}
{{/*            </header>*/}}
{{/*            {{.TableOfContents}}*/}}
{{/*        </aside>*/}}
{{/*    </div>*/}}
{{/*</section>*/}}
{{/*{{ end }}*/}}

{{ if .Params.toc }}
    <!-- ignore empty links with + -->
    {{ $headers := findRE "<h[1-4].*?>(.|\n])+?</h[1-4]>" .Content }}
    <!-- at least one header to link to -->
    {{ if ge (len $headers) 1 }}
        {{ $h1_n := len (findRE "(.|\n])+?" .Content) }}
        {{ $re := (cond (eq $h1_n 0) "<h[2-4]" "<h[1-4]") }}
        {{ $renum := (cond (eq $h1_n 0) "[2-4]" "[1-4]") }}


        <!--Grid column-->
        <div class="col-md-2 pl-0">

            <!--Scrollspy-->
            <div id="page-scrollspy" class="toc-nav">

                <ul class="nav nav-pills ml-0">
                    <!-- TOC header -->
                    <li class="nav-item pb-3 text-center">
                        <span class="font-weight-bold mb-2">- CATALOG - </span>
                    </li>

                    {{ range $headers }}
                        {{ $header := . }}
                        {{ range first 1 (findRE $re $header 1) }}
                            {{ range findRE $renum . 1 }}
                                {{ $next_heading := (cond (eq $h1_n 0) (sub (int .) 1 ) (int . ) ) }}
                                {{ range seq $next_heading }}
                                    <ul class="nav">
                                {{end}}
                                {{ $anchorId :=  (replaceRE ".* id=\"(.*?)\".*" "$1" $header ) }}

                                <li class="nav-item">
                                    <a class="nav-link" href="#{{ $anchorId }}">
                                        {{ $header | plainify | htmlUnescape }}
                                    </a>
                                </li>

                                <!-- close list -->
                                {{ range seq $next_heading }}
                                    </ul>
                                {{end}}
                            {{ end }}
                        {{ end }}
                    {{end}}

                </ul>
            </div>
            <!--Scrollspy-->

        </div>
        <!--Grid column-->
    {{ end }}
{{- end -}}